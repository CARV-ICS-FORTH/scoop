\documentclass[a4paper]{article}

\setlength{\pdfpagewidth}{\paperwidth}
\setlength{\pdfpageheight}{\paperheight}

\usepackage{fullpage}


% scoopversion.tex is generated automatically to define \scoopversion
\include{scoop.version}


\begin{document}
\title{SCOOP: Source COmpilation Optimizations for Parallelism \scoopversion}
\date{last update: 18/05/13}
\maketitle

\section{License}

\begin{tabbing}
Copyright (c) 2010-2012,\\
\ \ \=Dimitris Hassapis\ \ \ \ \=hassapis@ics.forth.gr\\
\>Foivos Zakkak        \>zakkak@ics.forth.gr\\
\>Polyvios Pratikakis  \>polyvios@ics.forth.gr\\
All rights reserved.
\end{tabbing}

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:\\

1. Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.\\

2. Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.\\

3. The names of the contributors may not be used to endorse or promote
products derived from this software without specific prior written
permission.\\

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER
OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\

\section{Annotation Syntax}

    \verb!  #pragma css start(list of variables)!\\
    \verb!  #pragma css finish!\\
    \verb!  #pragma css malloc!\\
    \verb!  #pragma css free!\\
    \verb!  #pragma css sync!\\
    \verb!  #pragma css wait all!\\
    \verb!  #pragma css wait on(list of variables)! //Not implemented yet\\
    \verb!  #pragma css task [in(<input parameters>)]!\\
    \verb!                   [inout(<input parameters>)]!\\
    \verb!                   [out(<input parameters>)]!\\
    \verb!                   [highpriority] (highpriority is simply ignored)!\\[1em]
    Parameter notation:\\

      Non stride: \ \verb!<parameter>[\[number of elements (for arrays)\]]!
      \footnote{XPPFX and nesting require the size in bytes and not in elements}\\

      Stride: \ \ \ \ \ \ \ \verb!<parameter>\[Block Rows|Block Columns\]\[[Array Rows|]Array Columns\]!\\
        \hspace{2cm}Array Rows is optional and is totally ignored\\

      Stride (Legacy): \ \ \ \ \ \ \ \verb!<parameter>\[stride\]\[ els | elsz \]!\\
        \hspace{2cm}where stride is the step (original row length)\\
        \hspace{2cm}els is the block's number of rows\\
        \hspace{2cm}elsz is the block's row length\\

      The parameter size/stride/els/elsz must be an expression, thus
      we don't allow function calls. Also there is no support for the
      conditional operator (? :)\\

    Example:
      \verb!#pragma css task in(a, b[4]) out(c[16])!


\section{Dependencies}

\begin{itemize}
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item ocaml
  \item camlp4/ocaml-camlp4/ocaml-camlp4-devel
  \item flex
  \item bison
  \item indent
  \item ncurses-devel
  \item emacs
\end{itemize}

\begin{tabbing}
for \emph{CELL B.E} runtimes you will also need the cell development package
including ppu\_intrinsics.h,\\ altivec.h etc in your include path
(C\_INCLUDE\_PATH)\\
  (e.g. \=\verb!export C_INCLUDE_PATH=$C_INCLUDE_PATH:/opt/cell/toolchain/lib/gcc/ppu/4.1.1/include!\\
   \>\verb!export C_INCLUDE_PATH=$C_INCLUDE_PATH:/opt/cell/toolchain/lib/gcc/spu/4.1.1/include!)\\
  and ppu32-gcc in your PATH\\
  (e.g. \verb!export PATH=$PATH:/opt/cell/toolchain/bin!)\\
\end{tabbing}

\section{Install}

  \verb!  ./configure && make!

\section{Run}

  \verb!  scoop --runtime=<adam/bddt/cell/cellgod/cellBlade/cellgodBlade/myrmics/scc/nesting/XPPFX> [options] <file> [file2 ...]!

\subsection{Options (Needs update)}

  \begin{tabbing}
  \ \ \=\verb!--runtime!\hspace{9em} \=
  Defines the target runtime/architecture\\
                                    \>\>adam | bddt | cell | cellgod | cellBlade | cellgodBlade | myrmics | scc | nesting | XPPFX\\[1ex]
  \>\verb!--cflags!                   \>Defines the flags you want to pass to gcc\\[1ex]
  \>\verb!--tpcIncludePath!           \>Defines the include path for the tpc runtime\\[1ex]
  \>\verb!--debugSCOOP!               \>Print debugging information\\[1ex]
  \>\verb!--trace!                    \>Trace SCOOP\\[1ex]
  \>\verb!--pragma!                   \>Specify the string constant following the pragma e.g. (default: css) will recognise \#pragma css ... (myrmics' default is myrmics)\\[1ex]
  \>\verb!--out-name!                 \>Specify the output files' prefix. e.g. (default: scoop\_trans) will produce scoop\_trans.c\\
                                    \>\>(and scoop\_trans\_func.c for cell)\\[1ex]
  \>\verb!--queue-size!               \>Specify the queue size for Cell. Defined in the Makefile as\\
                                    \>\>MAX\_QUEUE\_ENTRIES\\[1ex]
  \>\verb!--with-stats!               \>Enable code generation for statistics, for use with -DSTATISTICS\\[1ex]
%   \>\verb!--with-unaligned-arguments! \>Allow unaligned arguments in x86, for use with\\
%                                     \>\>-DUNALIGNED\_ARGUMENTS\_ALLOWED\\[1ex]
%   \>\verb!--with-blocking!            \>Enable blocking arguments in x86. for use with -DBLOCKING\\[1ex]
  \>\verb!--threaded!                 \>Generate thread safe code for Cell, for use with\\
                                    \>\>-DTPC\_MULTITHREADED\\[1ex]
  \>\verb!--disable-sdam!             \>Disable the static dependence analysis module
  \end{tabbing}

\section{Common Errors/Known Bugs}

\begin{itemize}
  \item Adding a semicolon at the end of \verb!#pragma!s
  \item Putting \verb!#pragma css barrier! at the end of a block (fix, add a semicolon right below of it)
  \item \textbf{{Fatal error: exception Invalid\_argument("Unknown")}} you
      probably have wrong argument at a call tagged with \verb!#pragma css task!
  \item Using \verb!#define!s in pragmas (preprocessor doesn't process them)
  \item Putting \verb!#pragma!s directly above a declaration of a variable (pragmas are only supported above statements)
  \item \textbf{Error: "segment\_\_\_0" not found in the \#pragma css task}
  usually means that the tool is renaming a variable due to previous declaration
  try renaming it manually (e.g. segment2) (This should be fixed by
  now)
  \item Using \verb!tpc_wait_all! instead of \verb!#pragma css
    barrier! results in broken SDAM
\end{itemize}

\end{document}
