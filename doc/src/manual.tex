% It doesnâ€™t do anything, per se, it just warns when you accidentally
% use deprecated LaTeX constructs from l2tabu
\RequirePackage[l2tabu, orthodox]{nag}

%% THis is to resolve error 131 in adobe reader
%\pdfobjcompresslevel=1

%\pdfminorversion=4
% Check https://en.wikibooks.org/wiki/LaTeX/Document_Structure for
% more info
\documentclass[
a4paper,
12pt,
]{article}

\input{preamble.tex}

% scoopversion.tex is generated automatically to define \scoopversion
\include{scoop.version}


\begin{document}

\begin{titlepage}
\begin{center}

  \vspace*{5cm}

  \LARGE \textbf{SCOOP v\scoopversion\\}
  Manual\\[0.5cm]
  \large \today\\ (Not fully up to date)

  \vfill

  \large Author: \href{mailto:zakkak@ics.forth.gr}{\textit{Foivos S. Zakkak}}\\[1cm]

  Foundation for Research and Technology - Hellas (FORTH)\\
  Institute of Computer Science\\
  N. Plastira 100\\
  Vassilika Vouton, GR-700 13 Heraklion, Crete, Greece\\[0.5cm]

\end{center}

\end{titlepage}

\pagenumbering{Roman}
\pagestyle{plain}

\section*{License}

\begin{verbatim}
Copyright (c) 2010-13,
                       Foivos   Zakkak     <zakkak@ics.forth.gr>
                       Dimitris Chassapis  <polyvios@ics.forth.gr>
                       Polyvios Pratikakis <polyvios@ics.forth.gr>


                       FORTH-ICS / CARV
                       (Foundation for Research & Technology -- Hellas,
                        Institute of Computer Science,
                        Computer Architecture & VLSI Systems Laboratory)


Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
\end{verbatim}

\newpage
\tableofcontents{}
\newpage
\pagenumbering{arabic}
\pagestyle{headings}

\section{Annotation Syntax}

    \verb!  #pragma css start(list of variables)!\\
    \verb!  #pragma css finish!\\
    \verb!  #pragma css malloc!\\
    \verb!  #pragma css free!\\
    \verb!  #pragma css sync!\\
    \verb!  #pragma css wait all!\\
    \verb!  #pragma css wait on(list of variables)! //Not implemented yet\\
    \verb!  #pragma css task [in(<input parameters>)]!\\
    \verb!                   [inout(<input parameters>)]!\\
    \verb!                   [out(<input parameters>)]!\\
    \verb!                   [highpriority] (highpriority is simply ignored)!\\[1em]
    Parameter notation:\\

      Non stride: \ \verb!<parameter>[\[number of elements (for arrays)\]]!
      \footnote{XPPFX and nesting require the size in bytes and not in elements}\\

      Stride: \ \ \ \ \ \ \ \verb!<parameter>\[Block Rows|Block Columns\]\[[Array Rows|]Array Columns\]!\\
        \hspace{2cm}Array Rows is optional and is totally ignored\\

      Stride (Legacy): \ \ \ \ \ \ \ \verb!<parameter>\[stride\]\[ els | elsz \]!\\
        \hspace{2cm}where stride is the step (original row length)\\
        \hspace{2cm}els is the block's number of rows\\
        \hspace{2cm}elsz is the block's row length\\

      The parameter size/stride/els/elsz must be an expression, thus
      we don't allow function calls. Also there is no support for the
      conditional operator (? :)\\

    Example:
      \verb!#pragma css task in(a, b[4]) out(c[16])!


\section{Installing}

This section describes how to install SCOOP on your system.  We
suppose that you have checked out/cloned SCOOP under \verb!/opt/scoop!
directory.  However the same instructions should apply for any
alternative path, simply replacing \verb!/opt/scoop! with the desired
alternative path for the rest of this section.

\subsection{Dependencies}

In order to build SCOOP you will need to install the following
packages:

\begin{itemize}
  \setlength{\itemsep}{1pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item ocaml
  \item camlp4/ocaml-camlp4/ocaml-camlp4-devel
  \item flex
  \item bison
  \item indent
  \item ncurses-devel
  \item emacs
  \item gperf
\end{itemize}

\begin{tabbing}
for \emph{CELL B.E} runtimes you will also need the cell development package
including ppu\_intrinsics.h,\\ altivec.h etc in your include path
(C\_INCLUDE\_PATH)\\
  (e.g. \=\verb!export C_INCLUDE_PATH=$C_INCLUDE_PATH:/opt/cell/toolchain/lib/gcc/ppu/4.1.1/include!\\
   \>\verb!export C_INCLUDE_PATH=$C_INCLUDE_PATH:/opt/cell/toolchain/lib/gcc/spu/4.1.1/include!)\\
  and ppu32-gcc in your PATH\\
  (e.g. \verb!export PATH=$PATH:/opt/cell/toolchain/bin!)\\
\end{tabbing}

\subsection{Compile}
To compile SCOOP you have to run \verb!configure! and then \verb!make!.
\begin{bash}
  ./configure && make
\end{bash}

\subsection{Install}
You can install SCOOP running
\begin{bash}
  sudo make install
\end{bash}
this will create a copy of the scoop executable in
\verb!/usr/local/bin!.

Alternatively you can append \verb!/opt/scoop! to the \verb!PATH!
variable.\\
i.e.
\begin{bash}
  echo "export PATH=$PATH:/opt/scoop" >> $HOME/.bashrc
\end{bash}

\subsection{Uninstall}

You can uninstall SCOOP running
\begin{bash}
  sudo make uninstall
\end{bash}
this will erase the copy of the scoop executable from
\verb!/usr/local/bin!.

If you chose the alternative method of adding \verb!/opt/scoop! to
your \verb!PATH! variable, simply remove the added line from your \verb!.bashrc!

\section{Using}

\begin{bash}
  scoop --runtime=<adam/bddt/cell/cellgod/cellBlade/cellgodBlade/myrmics/scc/nesting/XPPFX> [options] <file> [file2 ...]
\end{bash}

\subsection{Options (Needs update)}

  \begin{tabbing}
  \ \ \=\verb!--runtime!\hspace{9em} \=
  Defines the target runtime/architecture\\
                                    \>\>adam | bddt | cell | cellgod | cellBlade | cellgodBlade | myrmics | scc | nesting | XPPFX\\[1ex]
  \>\verb!--cflags!                   \>Defines the flags you want to pass to gcc\\[1ex]
  \>\verb!--tpcIncludePath!           \>Defines the include path for the tpc runtime\\[1ex]
  \>\verb!--debugSCOOP!               \>Print debugging information\\[1ex]
  \>\verb!--trace!                    \>Trace SCOOP\\[1ex]
  \>\verb!--pragma!                   \>Specify the string constant following the pragma e.g. (default: css) will recognise \#pragma css ... (myrmics' default is myrmics)\\[1ex]
  \>\verb!--out-name!                 \>Specify the output files' prefix. e.g. (default: scoop\_trans) will produce scoop\_trans.c\\
                                    \>\>(and scoop\_trans\_func.c for cell)\\[1ex]
  \>\verb!--queue-size!               \>Specify the queue size for Cell. Defined in the Makefile as\\
                                    \>\>MAX\_QUEUE\_ENTRIES\\[1ex]
  \>\verb!--with-stats!               \>Enable code generation for statistics, for use with -DSTATISTICS\\[1ex]
%   \>\verb!--with-unaligned-arguments! \>Allow unaligned arguments in x86, for use with\\
%                                     \>\>-DUNALIGNED\_ARGUMENTS\_ALLOWED\\[1ex]
%   \>\verb!--with-blocking!            \>Enable blocking arguments in x86. for use with -DBLOCKING\\[1ex]
  \>\verb!--threaded!                 \>Generate thread safe code for Cell, for use with\\
                                    \>\>-DTPC\_MULTITHREADED\\[1ex]
  \>\verb!--disable-sdam!             \>Disable the static dependence analysis module
  \end{tabbing}

\section{Common Errors/Limitations/Known Bugs}

\begin{itemize}
\item Adding a semicolon at the end of \verb!#pragma!s
\item Putting \verb!#pragma css barrier! at the end of a block (fix,
  add a semicolon right below of it)
\item \textbf{{Fatal error: exception Invalid\_argument("Unknown")}}
  you probably have wrong argument at a call tagged with
  \verb!#pragma css task!
\item Using \verb!#define!s in pragmas (preprocessor doesn't process
  them)
\item Putting \verb!#pragma!s directly above a declaration of a
  variable (pragmas are only supported above statements)
\item \textbf{Error: "segment\_\_\_0" not found in the \#pragma css
    task} usually means that the tool is renaming a variable due to
  previous declaration try renaming it manually (e.g. segment2) (This
  should be fixed by now)
\item Using \verb!tpc_wait_all! instead of \verb!#pragma css barrier!
  results in broken SDAM
\end{itemize}

\end{document}
